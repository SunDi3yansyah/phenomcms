/*
@inital author: Karl-Johan Sj√∂gren / http://blog.crazybeavers.se/
@contributor: Joost Elfering / http://yopefonic.wordpress.com/
@url: http://blog.crazybeavers.se/wp-content/demos/jquery.tag.editor/
@license: Creative Commons License - ShareAlike http://creativecommons.org/licenses/by-sa/3.0/
@version: 1.4
*/
(function(c){c.fn.tagEditor=function(a){var m={separator:',',items:[],className:'tagEditor',confirmRemoval:false,confirmRemovalText:'Do you really want to remove the tag?',completeOnSeparator:false,completeOnBlur:false,tagsBeforeField:false,initialParse:true,imageTag:false,imageTagUrl:'',continuousOutputBuild:false}if(a){a=c.extend(m,a)}else{a=m}var i,d=this,f;var h=[];return this.each(function(){f=c(document.createElement('input'));f.attr('type','hidden');if(a.continuousOutputBuild){f.attr('name',d.attr('name'));d.attr('name',d.attr('name')+'_old')}d.after(f);i=c(document.createElement('ul'));i.attr('class',a.className);if(a.tagsBeforeField)c(this).before(i);else c(this).after(i);for(var l=0;l<a.items.length;l++)k(c.trim(a.items[l]));if(a.initialParse)j();if(a.completeOnBlur)c(this).blur(j);n();c(this).keypress(o);var p=c(this).parents('form');if(!a.continuousOutputBuild){p.submit(function(){j();f.val(h.join(a.separator));f.attr('id',d.attr('id'));f.attr("name",d.attr('name'));d.attr('id',d.attr('id')+'_old');d.attr('name',d.attr('name')+'_old')})}function k(b){b=c.trim(b);for(var e=0;e<h.length;e++){if(h[e].toLowerCase()==b.toLowerCase())return false}var g=c(document.createElement('li'));g.text(b);g.attr('title','Remove tag');if(a.imageTag)g.append('<img src="'+a.imageTagUrl+'">');g.click(function(){if(a.confirmRemoval)if(!confirm(a.confirmRemovalText))return;g.remove();j()});i.append(g);return true}function q(){h=[];i.html('');d.val('');f.val('');for(var b=0;b<a.items.length;b++){k(c.trim(a.items[b]))}j()}function n(){h=[];var b=c('li',i);for(var e=0;e<b.length;e++)h.push(c.trim(c(b[e]).text()));if(a.continuousOutputBuild)f.val(h.join(a.separator))}function j(){var b=d.val().split(a.separator);for(var e=0;e<b.length;e++){var g=c.trim(b[e]);if(g.length>0)k(g)}d.val("");n()}function o(b){var e=(b.which)?b.which:b.keyCode;if(a.completeOnSeparator){if(String.fromCharCode(e)==a.separator){j();return false}}switch(e){case 13:if(c.trim(d.val())!=''){j();return false}return true;break}}c.fn.extend({tagEditorGetTags:function(){return h.join(a.separator)},tagEditorResetTags:function(){q()},tagEditorAddTag:function(b){return k(b)}})})}})(jQuery);